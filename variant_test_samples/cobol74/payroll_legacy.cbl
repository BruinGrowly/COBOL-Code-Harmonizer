       IDENTIFICATION DIVISION.
       PROGRAM-ID. PAYROLL74.
       AUTHOR. LEGACY-SYSTEMS-1978.
      *COBOL-74 LEGACY PAYROLL SYSTEM
      *NO SCOPE TERMINATORS, NO EVALUATE

       ENVIRONMENT DIVISION.
       INPUT-OUTPUT SECTION.
       FILE-CONTROL.
           SELECT EMPLOYEE-FILE ASSIGN TO EMPFILE
               ORGANIZATION IS INDEXED
               ACCESS MODE IS DYNAMIC
               RECORD KEY IS EMP-ID.
           SELECT PAYROLL-FILE ASSIGN TO PAYFILE
               ORGANIZATION IS SEQUENTIAL.

       DATA DIVISION.
       FILE SECTION.
       FD EMPLOYEE-FILE
           LABEL RECORDS ARE STANDARD
           VALUE OF FILE-ID IS 'EMPDATA'.
       01 EMPLOYEE-RECORD.
           05 EMP-ID           PIC 9(6).
           05 EMP-NAME         PIC X(30).
           05 EMP-RATE         PIC 9(3)V99.
           05 EMP-HOURS        PIC 9(3)V9.
           05 EMP-DEPT         PIC X(4).

       FD PAYROLL-FILE
           LABEL RECORDS ARE STANDARD.
       01 PAYROLL-RECORD.
           05 PAY-EMP-ID       PIC 9(6).
           05 PAY-GROSS        PIC 9(6)V99.
           05 PAY-TAX          PIC 9(5)V99.
           05 PAY-NET          PIC 9(6)V99.

       WORKING-STORAGE SECTION.
       01 WS-WORK-AREAS.
           05 WS-EMP-ID        PIC 9(6).
           05 WS-GROSS-PAY     PIC 9(6)V99.
           05 WS-TAX-AMT       PIC 9(5)V99.
           05 WS-NET-PAY       PIC 9(6)V99.
           05 WS-EOF           PIC X VALUE 'N'.
           05 WS-TAX-RATE      PIC V999 VALUE .225.

       PROCEDURE DIVISION.
       MAIN-LOGIC.
           PERFORM INIT-ROUTINE.
           PERFORM PROCESS-EMPLOYEES UNTIL WS-EOF = 'Y'.
           PERFORM END-ROUTINE.
           STOP RUN.

       INIT-ROUTINE.
           OPEN INPUT EMPLOYEE-FILE.
           OPEN OUTPUT PAYROLL-FILE.
           PERFORM READ-EMPLOYEE.

       READ-EMPLOYEE.
           READ EMPLOYEE-FILE
               AT END MOVE 'Y' TO WS-EOF.

       PROCESS-EMPLOYEES.
      *CLASSIC COBOL-74 STYLE - NO END-IF
           IF WS-EOF = 'N'
               MOVE EMP-ID TO WS-EMP-ID
               PERFORM CALC-GROSS-PAY
               PERFORM CALC-TAX
               PERFORM CALC-NET-PAY
               PERFORM WRITE-PAYROLL
               PERFORM READ-EMPLOYEE.

       CALC-GROSS-PAY.
           MULTIPLY EMP-RATE BY EMP-HOURS GIVING WS-GROSS-PAY.
      *NO ROUNDING IN COBOL-74 - TRUNCATES
           IF WS-GROSS-PAY > 999.99
               MOVE 999.99 TO WS-GROSS-PAY.

       CALC-TAX.
           MULTIPLY WS-GROSS-PAY BY WS-TAX-RATE GIVING WS-TAX-AMT.

       CALC-NET-PAY.
           SUBTRACT WS-TAX-AMT FROM WS-GROSS-PAY GIVING WS-NET-PAY.

       WRITE-PAYROLL.
           MOVE WS-EMP-ID TO PAY-EMP-ID.
           MOVE WS-GROSS-PAY TO PAY-GROSS.
           MOVE WS-TAX-AMT TO PAY-TAX.
           MOVE WS-NET-PAY TO PAY-NET.
           WRITE PAYROLL-RECORD.

       END-ROUTINE.
           CLOSE EMPLOYEE-FILE.
           CLOSE PAYROLL-FILE.
           DISPLAY 'PAYROLL PROCESSING COMPLETE'.
