>>SOURCE FORMAT IS FREE
>>IF DEBUG-MODE DEFINED
>>DISPLAY "Compiling in DEBUG mode"
>>END-IF
IDENTIFICATION DIVISION.
PROGRAM-ID. ModernInventory.
*> GnuCOBOL Free-Format Inventory Management
*> Demonstrates modern COBOL with free-format syntax

ENVIRONMENT DIVISION.
CONFIGURATION SECTION.
REPOSITORY.
    FUNCTION ALL INTRINSIC.

INPUT-OUTPUT SECTION.
FILE-CONTROL.
    SELECT INVENTORY-FILE ASSIGN TO "inventory.dat"
        ORGANIZATION IS INDEXED
        ACCESS MODE IS DYNAMIC
        RECORD KEY IS INV-PRODUCT-ID
        ALTERNATE RECORD KEY IS INV-CATEGORY WITH DUPLICATES
        FILE STATUS IS WS-FILE-STATUS.

DATA DIVISION.
FILE SECTION.
FD  INVENTORY-FILE.
01  INVENTORY-RECORD.
    05  INV-PRODUCT-ID          PIC X(12).
    05  INV-PRODUCT-NAME        PIC X(50).
    05  INV-CATEGORY            PIC X(20).
    05  INV-QUANTITY            PIC 9(6).
    05  INV-UNIT-PRICE          PIC 9(7)V99.
    05  INV-REORDER-POINT       PIC 9(6).
    05  INV-LAST-RESTOCKED      PIC X(10).
    05  INV-SUPPLIER            PIC X(30).

WORKING-STORAGE SECTION.
>>IF ENVIRONMENT-VAR "COBOL_ENV" = "PRODUCTION"
01  WS-ENVIRONMENT              PIC X(10) VALUE "PROD".
>>ELSE
01  WS-ENVIRONMENT              PIC X(10) VALUE "DEV".
>>END-IF

01  WS-FILE-STATUS              PIC XX.
01  WS-EOF-FLAG                 PIC X VALUE "N".
01  WS-RECORD-COUNT             PIC 9(6) VALUE ZERO.
01  WS-LOW-STOCK-COUNT          PIC 9(6) VALUE ZERO.
01  WS-TOTAL-VALUE              PIC 9(12)V99 VALUE ZERO.

01  WS-SEARCH-CATEGORY          PIC X(20).
01  WS-SEARCH-ID                PIC X(12).

01  WS-DISPLAY-PRICE            PIC $$$,$$$,$$9.99.
01  WS-DISPLAY-VALUE            PIC $$$,$$$,$$$,$$9.99.
01  WS-DISPLAY-QTY              PIC ZZZ,ZZ9.

*> Statistics
01  WS-STATISTICS.
    05  WS-TOTAL-ITEMS          PIC 9(6) VALUE ZERO.
    05  WS-CATEGORIES-PROCESSED PIC 9(4) VALUE ZERO.
    05  WS-VALUE-ELECTRONICS    PIC 9(11)V99 VALUE ZERO.
    05  WS-VALUE-FURNITURE      PIC 9(11)V99 VALUE ZERO.
    05  WS-VALUE-CLOTHING       PIC 9(11)V99 VALUE ZERO.
    05  WS-VALUE-OTHER          PIC 9(11)V99 VALUE ZERO.

PROCEDURE DIVISION.

MAIN-PROCEDURE.
    DISPLAY "========================================"
    DISPLAY "GnuCOBOL Modern Inventory System"
    DISPLAY "Free-Format Source - Environment: " WS-ENVIRONMENT
    DISPLAY "========================================"
    DISPLAY SPACE

    PERFORM INITIALIZE-SYSTEM
    PERFORM GENERATE-SAMPLE-DATA
    PERFORM ANALYZE-INVENTORY
    PERFORM CHECK-REORDER-POINTS
    PERFORM DISPLAY-STATISTICS
    PERFORM CLEANUP-SYSTEM

    STOP RUN.

INITIALIZE-SYSTEM.
    DISPLAY "Initializing inventory system..."

    OPEN OUTPUT INVENTORY-FILE
    IF WS-FILE-STATUS NOT = "00" THEN
        DISPLAY "Error opening inventory file: " WS-FILE-STATUS
        STOP RUN
    END-IF

    DISPLAY "Inventory file opened successfully"
    DISPLAY SPACE.

GENERATE-SAMPLE-DATA.
    DISPLAY "Generating sample inventory data..."

    *> Electronics
    MOVE "ELEC-001" TO INV-PRODUCT-ID
    MOVE "Laptop Computer 15-inch" TO INV-PRODUCT-NAME
    MOVE "ELECTRONICS" TO INV-CATEGORY
    MOVE 45 TO INV-QUANTITY
    MOVE 899.99 TO INV-UNIT-PRICE
    MOVE 10 TO INV-REORDER-POINT
    MOVE "2024-10-15" TO INV-LAST-RESTOCKED
    MOVE "TechSupply Inc." TO INV-SUPPLIER
    PERFORM WRITE-INVENTORY-RECORD

    MOVE "ELEC-002" TO INV-PRODUCT-ID
    MOVE "Wireless Mouse" TO INV-PRODUCT-NAME
    MOVE "ELECTRONICS" TO INV-CATEGORY
    MOVE 5 TO INV-QUANTITY
    MOVE 29.99 TO INV-UNIT-PRICE
    MOVE 20 TO INV-REORDER-POINT
    MOVE "2024-09-20" TO INV-LAST-RESTOCKED
    MOVE "TechSupply Inc." TO INV-SUPPLIER
    PERFORM WRITE-INVENTORY-RECORD

    MOVE "ELEC-003" TO INV-PRODUCT-ID
    MOVE "USB-C Hub 7-Port" TO INV-PRODUCT-NAME
    MOVE "ELECTRONICS" TO INV-CATEGORY
    MOVE 150 TO INV-QUANTITY
    MOVE 49.99 TO INV-UNIT-PRICE
    MOVE 50 TO INV-REORDER-POINT
    MOVE "2024-11-01" TO INV-LAST-RESTOCKED
    MOVE "TechSupply Inc." TO INV-SUPPLIER
    PERFORM WRITE-INVENTORY-RECORD

    *> Furniture
    MOVE "FURN-001" TO INV-PRODUCT-ID
    MOVE "Ergonomic Office Chair" TO INV-PRODUCT-NAME
    MOVE "FURNITURE" TO INV-CATEGORY
    MOVE 25 TO INV-QUANTITY
    MOVE 349.99 TO INV-UNIT-PRICE
    MOVE 5 TO INV-REORDER-POINT
    MOVE "2024-10-05" TO INV-LAST-RESTOCKED
    MOVE "Office Furnishings Co." TO INV-SUPPLIER
    PERFORM WRITE-INVENTORY-RECORD

    MOVE "FURN-002" TO INV-PRODUCT-ID
    MOVE "Standing Desk Adjustable" TO INV-PRODUCT-NAME
    MOVE "FURNITURE" TO INV-CATEGORY
    MOVE 3 TO INV-QUANTITY
    MOVE 599.99 TO INV-UNIT-PRICE
    MOVE 8 TO INV-REORDER-POINT
    MOVE "2024-09-15" TO INV-LAST-RESTOCKED
    MOVE "Office Furnishings Co." TO INV-SUPPLIER
    PERFORM WRITE-INVENTORY-RECORD

    *> Clothing
    MOVE "CLTH-001" TO INV-PRODUCT-ID
    MOVE "Business Shirt Size L" TO INV-PRODUCT-NAME
    MOVE "CLOTHING" TO INV-CATEGORY
    MOVE 200 TO INV-QUANTITY
    MOVE 59.99 TO INV-UNIT-PRICE
    MOVE 50 TO INV-REORDER-POINT
    MOVE "2024-10-20" TO INV-LAST-RESTOCKED
    MOVE "Fashion Wholesale Ltd." TO INV-SUPPLIER
    PERFORM WRITE-INVENTORY-RECORD

    MOVE "CLTH-002" TO INV-PRODUCT-ID
    MOVE "Work Pants Size 32" TO INV-PRODUCT-NAME
    MOVE "CLOTHING" TO INV-CATEGORY
    MOVE 12 TO INV-QUANTITY
    MOVE 79.99 TO INV-UNIT-PRICE
    MOVE 30 TO INV-REORDER-POINT
    MOVE "2024-08-10" TO INV-LAST-RESTOCKED
    MOVE "Fashion Wholesale Ltd." TO INV-SUPPLIER
    PERFORM WRITE-INVENTORY-RECORD

    DISPLAY "Sample data generated: " WS-RECORD-COUNT " records"
    DISPLAY SPACE

    *> Close and reopen for reading
    CLOSE INVENTORY-FILE
    OPEN INPUT INVENTORY-FILE.

WRITE-INVENTORY-RECORD.
    WRITE INVENTORY-RECORD
    IF WS-FILE-STATUS = "00" THEN
        ADD 1 TO WS-RECORD-COUNT
    ELSE
        DISPLAY "Write error: " WS-FILE-STATUS
            " for product " INV-PRODUCT-ID
    END-IF.

ANALYZE-INVENTORY.
    DISPLAY "Analyzing inventory..."
    DISPLAY "--------------------------------------------"

    MOVE "N" TO WS-EOF-FLAG
    MOVE ZERO TO WS-TOTAL-ITEMS

    PERFORM UNTIL WS-EOF-FLAG = "Y"
        READ INVENTORY-FILE NEXT RECORD
            AT END
                MOVE "Y" TO WS-EOF-FLAG
            NOT AT END
                PERFORM PROCESS-INVENTORY-ITEM
        END-READ
    END-PERFORM

    DISPLAY "Analysis complete: " WS-TOTAL-ITEMS " items processed"
    DISPLAY SPACE.

PROCESS-INVENTORY-ITEM.
    ADD 1 TO WS-TOTAL-ITEMS

    *> Calculate item value
    COMPUTE WS-TOTAL-VALUE =
        WS-TOTAL-VALUE + (INV-QUANTITY * INV-UNIT-PRICE)

    *> Categorize by type
    EVALUATE INV-CATEGORY
        WHEN "ELECTRONICS"
            COMPUTE WS-VALUE-ELECTRONICS =
                WS-VALUE-ELECTRONICS + (INV-QUANTITY * INV-UNIT-PRICE)
        WHEN "FURNITURE"
            COMPUTE WS-VALUE-FURNITURE =
                WS-VALUE-FURNITURE + (INV-QUANTITY * INV-UNIT-PRICE)
        WHEN "CLOTHING"
            COMPUTE WS-VALUE-CLOTHING =
                WS-VALUE-CLOTHING + (INV-QUANTITY * INV-UNIT-PRICE)
        WHEN OTHER
            COMPUTE WS-VALUE-OTHER =
                WS-VALUE-OTHER + (INV-QUANTITY * INV-UNIT-PRICE)
    END-EVALUATE

    *> Display item details
    MOVE INV-UNIT-PRICE TO WS-DISPLAY-PRICE
    MOVE INV-QUANTITY TO WS-DISPLAY-QTY

    DISPLAY INV-PRODUCT-ID " | "
            INV-PRODUCT-NAME(1:30) " | "
            INV-CATEGORY " | "
            "Qty: " WS-DISPLAY-QTY " | "
            "Price: " WS-DISPLAY-PRICE.

CHECK-REORDER-POINTS.
    DISPLAY SPACE
    DISPLAY "Checking reorder points..."
    DISPLAY "--------------------------------------------"

    CLOSE INVENTORY-FILE
    OPEN INPUT INVENTORY-FILE

    MOVE "N" TO WS-EOF-FLAG
    MOVE ZERO TO WS-LOW-STOCK-COUNT

    PERFORM UNTIL WS-EOF-FLAG = "Y"
        READ INVENTORY-FILE NEXT RECORD
            AT END
                MOVE "Y" TO WS-EOF-FLAG
            NOT AT END
                IF INV-QUANTITY <= INV-REORDER-POINT THEN
                    PERFORM DISPLAY-LOW-STOCK-ALERT
                END-IF
        END-READ
    END-PERFORM

    IF WS-LOW-STOCK-COUNT = ZERO THEN
        DISPLAY "No items below reorder point"
    ELSE
        DISPLAY "Items requiring reorder: " WS-LOW-STOCK-COUNT
    END-IF

    DISPLAY SPACE.

DISPLAY-LOW-STOCK-ALERT.
    ADD 1 TO WS-LOW-STOCK-COUNT

    MOVE INV-QUANTITY TO WS-DISPLAY-QTY

    DISPLAY "âš  LOW STOCK ALERT"
    DISPLAY "  Product: " INV-PRODUCT-NAME
    DISPLAY "  ID: " INV-PRODUCT-ID
    DISPLAY "  Current Qty: " WS-DISPLAY-QTY
    DISPLAY "  Reorder Point: " INV-REORDER-POINT
    DISPLAY "  Supplier: " INV-SUPPLIER
    DISPLAY SPACE.

DISPLAY-STATISTICS.
    DISPLAY "========================================"
    DISPLAY "Inventory Statistics"
    DISPLAY "========================================"

    DISPLAY "Total Items: " WS-TOTAL-ITEMS

    MOVE WS-TOTAL-VALUE TO WS-DISPLAY-VALUE
    DISPLAY "Total Inventory Value: " WS-DISPLAY-VALUE

    DISPLAY SPACE
    DISPLAY "Value by Category:"

    IF WS-VALUE-ELECTRONICS > ZERO THEN
        MOVE WS-VALUE-ELECTRONICS TO WS-DISPLAY-VALUE
        DISPLAY "  Electronics: " WS-DISPLAY-VALUE
    END-IF

    IF WS-VALUE-FURNITURE > ZERO THEN
        MOVE WS-VALUE-FURNITURE TO WS-DISPLAY-VALUE
        DISPLAY "  Furniture:   " WS-DISPLAY-VALUE
    END-IF

    IF WS-VALUE-CLOTHING > ZERO THEN
        MOVE WS-VALUE-CLOTHING TO WS-DISPLAY-VALUE
        DISPLAY "  Clothing:    " WS-DISPLAY-VALUE
    END-IF

    IF WS-VALUE-OTHER > ZERO THEN
        MOVE WS-VALUE-OTHER TO WS-DISPLAY-VALUE
        DISPLAY "  Other:       " WS-DISPLAY-VALUE
    END-IF

    DISPLAY SPACE.

CLEANUP-SYSTEM.
    CLOSE INVENTORY-FILE
    DISPLAY "System shutdown complete.".

END PROGRAM ModernInventory.
